<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shopping Cart</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header Section - Simulated Walmart Header -->
    <header class="bg-blue-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex items-center justify-between flex-wrap">
            <!-- Walmart Logo (Placeholder) -->
            <div class="flex items-center space-x-2 mb-2 md:mb-0">
                <img src="https://placehold.co/30x30/0000FF/FFFFFF?text=W" alt="Walmart Logo" class="rounded-full" />
                <span class="text-xl font-bold">Walmart</span>
            </div>

            <!-- Search Bar (Placeholder) -->
            <div class="relative flex-grow mx-4 max-w-lg mb-2 md:mb-0">
                <input
                    type="text"
                    placeholder="Search everything at Walmart online and in store"
                    class="w-full p-2 pl-10 rounded-full text-black focus:outline-none focus:ring-2 focus:ring-blue-300"
                />
                <svg
                    class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    ></path>
                </svg>
            </div>

            <!-- Right Navigation Icons (Placeholder) -->
            <nav class="flex items-center space-x-4">
                <a href="#" class="flex items-center space-x-1 hover:underline">
                    <svg
                        class="h-6 w-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                        ></path>
                    </svg>
                    <span>Account</span>
                </a>
                <a href="#" class="flex items-center space-x-1 hover:underline">
                    <svg
                        class="h-6 w-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                        ></path>
                    </svg>
                    <span id="cart-total-price">$0.00</span>
                </a>
            </nav>
        </div>
        <!-- Secondary Navigation (Placeholder) -->
        <div class="container mx-auto mt-2 flex justify-between text-sm flex-wrap">
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Departments</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Services</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Get It Fast</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">New Arrivals</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Delivery</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Trending</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">Back to School</a>
            <a href="#" class="px-3 py-1 hover:bg-blue-600 rounded">My Items</a>
        </div>
    </header>

    <!-- Main Content Area -->
    <div class="container mx-auto px-4 py-8 md:flex md:space-x-6">
        <!-- Left Column - Cart Details -->
        <div class="md:w-2/3 bg-white p-6 rounded-lg shadow-md mb-6 md:mb-0">
            <h2 class="text-2xl font-bold mb-6">Cart (<span id="item-count">0</span> items)</h2>

            <!-- Pickup and Delivery Options -->
            <div class="bg-blue-50 p-4 rounded-lg flex items-start space-x-3 mb-6 shadow-sm">
                <svg
                    class="h-6 w-6 text-blue-600 flex-shrink-0"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0L6.343 16.657m11.314 0A8.06 8.06 0 0122 10c0-4.418-3.582-8-8-8a8.06 8.06 0 00-4.939 1.638 7.995 7.995 0 00-4.94 4.025m11.314 0L15 10m-3-7V21"
                    ></path>
                </svg>
                <div>
                    <h3 class="font-semibold text-lg text-gray-800">Pickup and delivery options</h3>
                    <p class="text-blue-600 text-sm cursor-pointer hover:underline">Change options</p>
                </div>
            </div>

            <!-- Shipping Details -->
            <div class="border border-gray-200 rounded-lg p-6 mb-6 shadow-sm">
                <div class="flex items-center mb-4">
                    <svg
                        class="h-6 w-6 text-gray-600 mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 17l-4 4m0-4l4 4m-4-4H19m-9-2h9a2 2 0 002-2V7a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z"
                        ></path>
                    </svg>
                    <h3 class="font-semibold text-lg text-gray-800">Shipping, arrives by Fri, Jun 27</h3>
                </div>
                <p class="text-sm text-gray-600 mb-2">
                    Order within <span class="font-medium text-green-600">3 hr 7 min</span>
                </p>
                <div class="flex items-center text-blue-600 text-sm">
                    <svg
                        class="h-4 w-4 mr-1"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0L6.343 16.657m11.314 0A8.06 8.06 0 0122 10c0-4.418-3.582-8-8-8a8.06 8.06 0 00-4.939 1.638 7.995 7.995 0 00-4.94 4.025m11.314 0L15 10m-3-7V21"
                        ></path>
                    </svg>
                    <span>95829</span>
                </div>
            </div>

            <!-- Product List -->
            <div id="cart-items" class="space-y-4">
                <!-- Cart items will be dynamically inserted here -->
            </div>
        </div>

        <!-- Right Column - Order Summary -->
        <div class="md:w-1/3">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <button
                    id="checkout-btn"
                    class="w-full bg-blue-600 text-white py-3 rounded-full font-bold text-lg hover:bg-blue-700 transition-colors mb-4"
                    disabled
                >
                    Continue to checkout
                </button>

                <p class="text-sm text-gray-600 mb-4">
                    For the best shopping experience,
                    <a href="#" class="text-blue-600 hover:underline">sign in</a>.
                </p>

                <div class="border-t border-gray-200 pt-4 space-y-2">
                    <div class="flex justify-between text-gray-700">
                        <span>Subtotal (<span id="summary-item-count">0</span> items)</span>
                        <span id="subtotal-amount">$0.00</span>
                    </div>
                    <div class="flex justify-between text-gray-700 text-sm">
                        <span>Shipping <span class="text-gray-500">(below $35 order minimum)</span></span>
                        <span id="shipping-amount">$6.99</span>
                    </div>
                    <div class="flex justify-between text-gray-700">
                        <span>Taxes</span>
                        <span>Calculated at checkout</span>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-4 mt-4 flex justify-between items-center">
                    <span class="text-xl font-bold text-gray-900">Estimated total</span>
                    <span class="text-xl font-bold text-gray-900" id="estimated-total">$0.00</span>
                </div>
            </div>

            <!-- Free Shipping Offer -->
            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg shadow-sm mt-6">
                <div class="flex items-start space-x-3 mb-2">
                    <img
                        src="https://placehold.co/24x24/0000FF/FFFFFF?text=W+"
                        alt="Walmart+ icon"
                        class="rounded-full"
                    />
                    <div>
                        <p class="font-semibold text-gray-800">
                            Get free shipping & skip the $6.99 shipping fee—even on small orders!
                        </p>
                        <p class="text-sm text-gray-600">Try Walmart+ free for 30 days</p>
                    </div>
                </div>
                <button
                    class="w-full bg-white text-blue-600 border border-blue-600 py-2 rounded-full font-bold hover:bg-blue-50 transition-colors"
                >
                    Start your 30-day free trial
                </button>
            </div>
        </div>
    </div>

    <script>
        async function fetchCartItems() {
            try {
                const response = await fetch('/cartItems');
                if (!response.ok) {
                    throw new Error('Failed to fetch cart items');
                }
                const cartItems = await response.json();
                if (cartItems.length === 0) {
                    // Redirect to emptycart.html if cart is empty
                    window.location.href = 'emptycart.html';
                    return;
                }
                renderCart(cartItems);
            } catch (error) {
                console.error(error);
                alert('Error loading cart items');
            }
        }

        function renderCart(cart) {
            const cartItemsContainer = document.getElementById("cart-items");
            const itemCountElem = document.getElementById("item-count");
            const summaryItemCountElem = document.getElementById("summary-item-count");
            const subtotalAmountElem = document.getElementById("subtotal-amount");
            const shippingAmountElem = document.getElementById("shipping-amount");
            const estimatedTotalElem = document.getElementById("estimated-total");
            const checkoutBtn = document.getElementById("checkout-btn");
            const cartTotalPriceElem = document.getElementById("cart-total-price");

            cartItemsContainer.innerHTML = "";
            let subtotal = 0;
            let totalItems = 0;

            cart.forEach((product) => {
                subtotal += parseFloat(product.Sale_Price) * product.count;
                totalItems += product.count;

                const itemDiv = document.createElement("div");
                itemDiv.className = "flex items-start mb-4";

                itemDiv.innerHTML = `
                    <img src="${product.Product_imgUrl}" alt="${product.Product_Name}" class="w-24 h-24 object-cover rounded-lg mr-4 shadow" />
                    <div class="flex-grow">
                        <p class="text-sm text-gray-600 mb-1">${product.Brand}</p>
                        <p class="text-green-600 text-sm font-medium mb-2">Free shipping on orders over $35</p>
                        <h4 class="font-semibold text-gray-800 mb-2">${product.Product_Name}</h4>
                        <div class="text-sm text-gray-500 mb-2">
                            <p>Free 90-day returns</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex space-x-2">
                                <button class="text-gray-500 hover:text-gray-700 text-sm remove-btn" data-id="${product.id}">Remove</button>
                                <button class="text-gray-500 hover:text-gray-700 text-sm save-later-btn" data-id="${product.id}">Save for later</button>
                            </div>
                            <div class="flex items-center border border-gray-300 rounded-md">
                                <button class="p-2 text-gray-600 hover:bg-gray-100 rounded-l-md quantity-decrease" data-id="${product.id}">-</button>
                                <span class="p-2 text-gray-800 font-medium quantity-value" data-id="${product.id}">${product.count}</span>
                                <button class="p-2 text-gray-600 hover:bg-gray-100 rounded-r-md quantity-increase" data-id="${product.id}">+</button>
                            </div>
                            <span class="text-lg font-bold text-gray-900">$${(parseFloat(product.Sale_Price) * product.count).toFixed(2)}</span>
                        </div>
                    </div>
                `;

                cartItemsContainer.appendChild(itemDiv);
            });

            // Update summary
            itemCountElem.textContent = totalItems;
            summaryItemCountElem.textContent = totalItems;
            subtotalAmountElem.textContent = `$${subtotal.toFixed(2)}`;

            // Shipping fee logic
            const shippingFee = subtotal >= 35 ? 0 : 6.99;
            shippingAmountElem.textContent = shippingFee === 0 ? "$0.00" : "$6.99";

            // Estimated total
            const estimatedTotal = subtotal + shippingFee;
            estimatedTotalElem.textContent = `$${estimatedTotal.toFixed(2)}`;

            // Update cart total price in header
            cartTotalPriceElem.textContent = `$${estimatedTotal.toFixed(2)}`;

            // Enable or disable checkout button
            checkoutBtn.disabled = totalItems === 0;
        }

        // Fetch cart items on page load
        document.addEventListener('DOMContentLoaded', fetchCartItems);

        // Event delegation for cart actions
        document.getElementById("cart-items").addEventListener("click", async (e) => {
            const id = parseInt(e.target.getAttribute("data-id"));
            if (e.target.classList.contains("remove-btn")) {
                await removeFromCart(id);
            } else if (e.target.classList.contains("save-later-btn")) {
                await saveForLater(id);
            } else if (e.target.classList.contains("quantity-increase")) {
                await changeQuantity(id, 1);
            } else if (e.target.classList.contains("quantity-decrease")) {
                await changeQuantity(id, -1);
            }
        });

        async function removeFromCart(id) {
            try {
                // Find cart item by id
                const response = await fetch(`/cartItems?idd=${id}`);
                const items = await response.json();
                if (items.length === 0) return;
                const item = items[0];

                // Delete cart item
                await fetch(`/cartItems/${item.id}`, { method: 'DELETE' });
                await fetchCartItems();
            } catch (error) {
                console.error('Error removing item:', error);
            }
        }

        async function saveForLater(id) {
            // For now, just remove from cart
            await removeFromCart(id);
            alert("Item saved for later.");
        }

        async function changeQuantity(id, delta) {
            try {
                const response = await fetch(`/cartItems?idd=${id}`);
                const items = await response.json();
                if (items.length === 0) return;
                const item = items[0];
                const newCount = item.count + delta;
                if (newCount < 1) return;

                const updatedItem = { ...item, count: newCount };
                await fetch(`/cartItems/${item.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedItem),
                });
                await fetchCartItems();
            } catch (error) {
                console.error('Error updating quantity:', error);
            }
        }
    </script>
</body>
</html>
